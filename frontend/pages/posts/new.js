import Layout from '../../components/Layout'; import { useState } from 'react'; import { useRouter } from 'next/router'; export default function NewPost(){ const [form,setForm]=useState({title:'',content:''}); const [err,setErr]=useState(''); const router=useRouter(); async function submit(e){ e.preventDefault(); try{ const res=await fetch(`${process.env.NEXT_PUBLIC_API_URL||'http://localhost:4000'}/api/posts`,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(form), credentials:'include' }); if(!res.ok) throw new Error((await res.json()).message||'Create failed'); const post=await res.json(); router.push(`/posts/${post.id}`); }catch(e){ setErr(e.message); } } return (<Layout><h1 className="text-2xl font-bold mb-4">New Post</h1>{err&&<p className="text-red-600">{err}</p>}<form onSubmit={submit} className="space-y-3 max-w-2xl"><input className="w-full border p-2 rounded" placeholder="Title" onChange={e=>setForm({...form,title:e.target.value})} /><textarea className="w-full border p-2 rounded h-60" placeholder="Content" onChange={e=>setForm({...form,content:e.target.value})} /><button className="px-4 py-2 bg-black text-white rounded">Publish</button></form></Layout>); }

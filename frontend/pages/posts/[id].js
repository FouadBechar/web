import Layout from '../../components/Layout'; import { useRouter } from 'next/router'; import { useEffect,useState } from 'react'; export default function PostDetail(){ const { query } = useRouter(); const [post,setPost]=useState(null); const [comment,setComment]=useState(''); const [err,setErr]=useState(''); useEffect(()=>{ if(!query.id) return; (async()=>{ try{ const res=await fetch(`${process.env.NEXT_PUBLIC_API_URL||'http://localhost:4000'}/api/posts/${query.id}`); const data=await res.json(); setPost(data); }catch(e){ setErr(e.message); } })(); },[query.id]); async function submit(e){ e.preventDefault(); try{ await fetch(`${process.env.NEXT_PUBLIC_API_URL||'http://localhost:4000'}/api/comments`,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ postId: Number(query.id), content: comment }), credentials:'include' }); const res=await fetch(`${process.env.NEXT_PUBLIC_API_URL||'http://localhost:4000'}/api/posts/${query.id}`); setPost(await res.json()); setComment(''); }catch(e){ setErr(e.message); } } if(!post) return <Layout>Loading…</Layout> return (<Layout>{err&&<p className="text-red-600">{err}</p>}<h1 className="text-3xl font-bold">{post.title}</h1><p className="text-sm text-gray-500">by {post.author?.name} • {new Date(post.createdAt).toLocaleString()}</p><article className="prose max-w-none mt-4">{post.content}</article><h3 className="text-xl font-semibold mt-8 mb-2">Comments</h3><form onSubmit={submit} className="flex gap-2 mb-4"><input className="flex-1 border p-2 rounded" placeholder="Write a comment…" value={comment} onChange={e=>setComment(e.target.value)} /><button className="px-3 py-2 bg-black text-white rounded">Send</button></form><div className="space-y-3">{post.comments?.map(c => (<div key={c.id} className="border rounded p-3 bg-white"><p className="text-sm text-gray-700">{c.content}</p><p className="text-xs text-gray-500">— {c.author?.name} • {new Date(c.createdAt).toLocaleString()}</p></div>))}</div></Layout>); }
